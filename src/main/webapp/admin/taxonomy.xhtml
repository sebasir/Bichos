<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
			 xmlns:h="http://java.sun.com/jsf/html"
			 xmlns:ui="http://java.sun.com/jsf/facelets"
			 xmlns:p="http://primefaces.org/ui"
			 xmlns:f="http://java.sun.com/jsf/core"
			 template="admin.xhtml">
    <ui:define name="body">
	   <h:form id="formTaxonomy">
		  <p:panel id="data">
			 <f:facet name="header">
				<h:outputText value="Clasificaciónes Taxonómicas" />
			 </f:facet>
			 <p:tree id="taxTree" value="#{taxonomyBean.taxRoot}" var="tax" orientation="horizontal" cache="false" selectionMode="single" selection="#{taxonomyBean.selectedNode}" dynamic="true" animate="true">
				<p:treeNode expandedIcon="ui-icon-folder-open" collapsedIcon="ui-icon-folder-collapsed">
				    <h:outputText value="#{tax}" />
				</p:treeNode>
			 </p:tree>
			 <p:contextMenu for="taxTree">
				<p:menuitem value="Agregar Clasificación" update="taxTree :createDialog" actionListener="#{taxonomyBean.setTaxfromNode('create')}" icon="ui-icon-plusthick"/>
				<p:menuitem value="Ver detalle de Especies" update="detailDialog" actionListener="#{taxonomyBean.setTaxfromNode('detail')}" icon="ui-icon-folder-open" />
				<p:menuitem value="Editar" update="taxTree :editDialog :displayEdit" actionListener="#{taxonomyBean.setTaxfromNode('edit')}" icon="ui-icon-pencil"/>
				<p:menuitem value="Borrar" update="taxTree" actionListener="#{taxonomyBean.setTaxfromNode('delete')}" icon="ui-icon-trash"/>
			 </p:contextMenu>
		  </p:panel>
		  <p:growl id="messages" showDetail="true"/>
	   </h:form>

	   <p:dialog id="detailDialog" width="500px" appendTo="@(body)" widgetVar="taxonomyDetail" modal="true" dynamic="true" resizable="false" header="#{taxonomyBean.taxonomy.taxonomyName}" closeOnEscape="true">
		  <p:dataList id="dataListSpecimen" paginator="true" rows="5" value="#{taxonomyBean.taxonomySpecimens}" var="specimen" emptyMessage="No se encontraron especímenes asociados a esta clasificación" paginatorPosition="bottom">
			 #{specimen.commonName} <span class="cursive">(#{specimen.specificEpithet})</span>
		  </p:dataList>
	   </p:dialog>

	   <p:dialog id="createDialog" widgetVar="taxonomyCreate" modal="true" resizable="false" appendTo="@(body)" header="Nueva Clasificación" closeOnEscape="true" > 
		  <h:form id="taxonomyCreateForm" prependId="false">
			 <p:panelGrid id="displayCreate" columns="2">
				<p:outputLabel value="Nombre Clasificación:" for="taxName" />
				<p:inputText id="taxName" value="#{taxonomyBean.taxonomy.taxonomyName}" title="Nombre Ubicación" rendered="true" style="width: 100%" required="true" requiredMessage="Debes definir el nombre de la clasificación!"/>
				<p:outputLabel value="Nivel Clasificación:" for="level" />
				<p:selectOneMenu id="level" value="#{taxonomyBean.selectedLevel}" effect="fade" required="true" rendered="true" requiredMessage="Debes escoger una jerarquía!">
				    <f:selectItem itemLabel="Selecciona una jerarquía" itemValue="" />
				    <f:selectItems value="#{taxonomyBean.avalLevels}" var="lev" itemLabel="#{lev.taxlevelName}" itemValue="#{lev.idTaxlevel}" />
				</p:selectOneMenu>
			 </p:panelGrid>
			 <p:commandButton id="createSave" value="Guardar" action="#{taxonomyBean.persist()}" update=":formTaxonomy" oncomplete="PF('taxonomyCreate').hide()"/>
		  </h:form>
	   </p:dialog>

	   <p:dialog id="editDialog" widgetVar="taxonomyEdit" modal="true" resizable="false" appendTo="@(body)" header="Editar a #{taxonomyBean.taxonomy.description}" closeOnEscape="true" > 
		  <h:form id="taxonomyEditForm" prependId="false">
			 <p:panelGrid id="displayEdit" columns="2">
				<p:outputLabel value="Nombre Clasificación:" for="taxEName" />
				<p:inputText id="taxEName" value="#{taxonomyBean.taxonomy.taxonomyName}" title="Nombre Ubicación" rendered="true" style="width: 100%" required="true" requiredMessage="Debes definir el nombre de la clasificación!"/>
				<p:outputLabel value="Nivel Clasificación:" for="levelE" />
				<p:selectOneMenu id="levelE" value="#{taxonomyBean.selectedLevel}" effect="fade" style="width: 100%" required="true" rendered="true" requiredMessage="Debes escoger una jerarquía!">
				    <f:selectItem itemLabel="Selecciona una jerarquía" itemValue="" />
				    <f:selectItems value="#{taxonomyBean.allLevels}" var="lev" itemLabel="#{lev.taxlevelName}" itemValue="#{lev.idTaxlevel}" />
				</p:selectOneMenu>
			 </p:panelGrid>
			 <p:commandButton id="editSave" value="Guardar" action="#{taxonomyBean.edit()}" update=":formTaxonomy" oncomplete="PF('taxonomyEdit').hide()"/>
		  </h:form>
	   </p:dialog>

	   <p:confirmDialog id="deleteDialog" appendTo="@(body)" widgetVar="taxonomyDelete" message="¿Está seguro que desea eliminar este registro?" showEffect="fade" hideEffect="fade" header="Confirmar eliminación" severity="alarm">
		  <h:form id="deleteForm" style=""> 
			 <p:commandButton id="deleteYesButton" value="Eliminar" action="#{taxonomyBean.delete}" update=":formTaxonomy" oncomplete="PF('taxonomyDelete').hide()" />
			 <p:commandButton id="deleteNoButton" value="Cancelar" onclick="PF('taxonomyDelete').hide()" type="button" />
		  </h:form>
	   </p:confirmDialog>
    </ui:define>
</ui:composition>